---
description: |
  手動でコードレビューを実行する。アーキテクチャレビューと
  セキュリティレビューを並列で実行し、結果を集約する。
---

以下の対象に対してコードレビューを実行してください。

## 対象

$ARGUMENTS

（引数なしの場合: 直近のコミット変更をレビュー）

## 実行手順

### Step 1: 対象ファイルの特定

1. 引数がある場合: 指定されたファイル/ディレクトリをレビュー
2. 引数がない場合: `git diff --name-only HEAD~1` で変更ファイルを特定

### Step 2: 並列レビュー実行

以下の2つのレビューを並列で実行:

#### アーキテクチャレビュー（reviewer）
- コード構造
- 依存関係の方向
- 命名規則
- SOLID原則の遵守
- テストカバレッジ

#### セキュリティレビュー（security-reviewer）
- インジェクション脆弱性
- 認証・認可
- データ保護
- OWASP Top 10

### Step 3: 結果の集約

1. `queue/reports/` からレビュー結果を収集
2. 以下のルールで判定:
   - `all("approved")` → 全て承認、問題なし
   - `any("needs_fix")` → 修正が必要な項目あり

3. 結果を表示:
   ```
   ## レビュー結果

   | レビュー | 結果 | 指摘数 |
   |---------|------|--------|
   | アーキテクチャ | approved/needs_fix | N件 |
   | セキュリティ | approved/needs_fix | N件 |

   ### 総合判定: APPROVED / NEEDS_FIX

   ### 指摘事項（重大度順）
   1. [critical] ... (security-review)
   2. [high] ... (arch-review)
   ...
   ```

### Step 4: 修正提案（needs_fixの場合）

修正が必要な場合、以下を提示:
- 問題のあるコードの場所
- 具体的な修正方法
- 修正後の期待される状態

## 注意事項

- レビュー結果は `queue/reports/` に保存される
- Conductorはレビュー結果の集約のみを行い、自分でコードを修正しない
- 修正はユーザーの承認後に別途実行する
